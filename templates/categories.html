<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Categories & Brands - Compliance Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { margin:0; font-family:'Roboto', Arial, sans-serif; background:#f4f6f9; color:#333; }

  /* Navbar */
  .navbar {
    position: fixed; top:0; left:0; right:0; height:60px;
    background:#2F3C7E; color:white;
    display:flex; align-items:center; justify-content:space-between;
    padding:0 20px; z-index:1000;
  }
  .navbar h2 { margin:0; font-size:22px; }
  .navbar ul { list-style:none; display:flex; margin:0; padding:0; }
  .navbar ul li { margin-left:20px; }
  .navbar ul li a { color:white; text-decoration:none; font-weight:bold; padding:10px 12px; border-radius:5px; }
  .navbar ul li a:hover, .navbar ul li a.active { background:#1d2659; }
  .menu-toggle { display:none; font-size:24px; cursor:pointer; }

  @media(max-width:768px){
    .navbar ul { flex-direction:column; position:absolute; top:60px; left:0; right:0; background:#2F3C7E; display:none; }
    .navbar ul.show { display:flex; }
    .navbar ul li { margin:0; }
    .menu-toggle { display:block; }
  }

  /* Profile Dropdown */
  .profile-container { position: relative; display:inline-block; }
  .profile-icon { width:45px; height:45px; border-radius:50%; border:2px solid white; cursor:pointer; transition:0.3s; }
  .profile-icon:hover { transform: scale(1.1); }
  .dropdown-card {
    display:none;
    position:absolute; right:0; top:60px;
    background:white; border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,0.25);
    padding:20px; width:280px; text-align:left; z-index:1001;
  }
  .dropdown-card.show { display:block; }
  .dropdown-card .profile-header { display:flex; align-items:center; gap:15px; margin-bottom:15px; }
  .dropdown-card .profile-header img { width:60px; height:60px; border-radius:50%; border:2px solid #2F3C7E; }
  .dropdown-card .profile-header div strong { font-size:16px; color:#2F3C7E; }
  .dropdown-card .profile-header div span { font-size:14px; color:#555; display:block; }
  .dropdown-card .profile-stats { font-size:14px; color:#333; margin-bottom:15px; }
  .dropdown-card hr { border:none; border-top:1px solid #eee; margin:10px 0; }
  .dropdown-card a { display:block; text-decoration:none; color:white; background:#DB5A5A; font-weight:bold; text-align:center; padding:10px 0; border-radius:6px; margin-top:5px; transition:0.3s; }
  .dropdown-card a:hover { background:#a63b3b; }

  /* Hero Section */
  .hero {
    background: linear-gradient(135deg, #2F3C7E, #70C1B3);
    color:white; text-align:center;
    border-radius:12px; padding:60px 20px; margin:80px auto 30px auto; max-width:1200px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
  }
  .hero h1 { font-size:42px; margin-bottom:20px; line-height:1.2; animation: slideDown 1s ease; }
  .hero p { font-size:20px; margin-bottom:30px; max-width:800px; margin-left:auto; margin-right:auto; animation: fadeIn 2s ease; }
  .hero button {
    background:#DB5A5A; color:white; border:none; padding:15px 30px; font-size:18px;
    border-radius:8px; font-weight:bold; cursor:pointer; transition:0.3s; animation: slideUp 1s ease;
  }
  .hero button:hover { background:#a63b3b; transform: translateY(-3px); }

  @keyframes slideDown {0% { transform: translateY(-50px); opacity:0; } 100% { transform: translateY(0); opacity:1; }}
  @keyframes slideUp {0% { transform: translateY(50px); opacity:0; } 100% { transform: translateY(0); opacity:1; }}
  @keyframes fadeIn {0% { opacity:0; } 100% { opacity:1; }}

  /* Content */
  .content { padding:20px; max-width:1200px; margin:0 auto; }

  /* Cards */
  .cards { display:flex; gap:20px; justify-content:space-around; flex-wrap:wrap; margin-bottom:20px; }
  .card { flex:1; min-width:200px; background:white; padding:20px; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,0.1); text-align:center; border-top:4px solid #2F3C7E; }
  .card h2 { margin:10px 0; color:#2F3C7E; }

  /* Filters */
  .filters { background:white; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px; display:flex; flex-wrap:wrap; gap:10px; }
  .filters input, .filters select, .filters button { padding:8px; border-radius:6px; border:1px solid #ccc; }
  .filters button { background:#2F3C7E; color:white; border:none; cursor:pointer; }
  .filters button:hover { background:#1d2659; }

  /* Table */
  table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  th,td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
  th { background:#A8D0E6; color:#333; font-weight:bold; }
  tr:hover { background:#f1f1f1; transition:0.3s; }
  tr:nth-child(even) { background:#f9f9f9; }
  
  /* Responsive table */
  @media(max-width:768px){
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { position: absolute; top: -9999px; left: -9999px; }
    tr { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
    td { border: none; position: relative; padding-left: 50%; }
    td:before { content: attr(data-label); position: absolute; left: 6px; width: 45%; padding-right: 10px; white-space: nowrap; font-weight: bold; }
  }

  /* Category Dropdown */
  #categoryDropdown {
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  #categoryDropdown:hover {
    box-shadow: 0 4px 8px rgba(47, 60, 126, 0.2);
    border-color: #1d2659;
  }
  #categoryDropdown:focus {
    outline: none;
    border-color: #1d2659;
    box-shadow: 0 0 0 3px rgba(47, 60, 126, 0.1);
  }

  /* Footer */
  footer { text-align:center; padding:15px; background:#2F3C7E; color:white; margin-top:20px; border-radius:12px; }
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <h2>Vigyantram</h2>
  <span class="menu-toggle" onclick="toggleMenu()">â˜°</span>
  <ul id="nav-links">
    <li><a href="{{ url_for('home') }}">Home</a></li>
    <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
    <li><a href="{{ url_for('product_monitoring') }}">Product Monitoring</a></li>
    <li><a href="{{ url_for('violation_reports') }}" >Violation Reports</a></li>
    <li><a href="{{ url_for('categories') }}"class="active">Categories/Brands</a></li>
    <li><a href="{{ url_for('geo_heatmap') }}">Geo Heatmap</a></li>
    <li><a href="{{ url_for('rule_engine') }}">Rule Engine</a></li>
  </ul>

  <!-- Profile Icon -->
  <div class="profile-container">
    <img src="/static/profile.png" alt="Profile" class="profile-icon" onclick="toggleDropdown()">
    <div class="dropdown-card" id="profileDropdown">
      <div class="profile-header">
        <img src="/static/profile.png" alt="Profile Pic">
        <div>
          <strong>Rohit Bavale</strong>
          <span>Email: rohit@example.com</span>
          <span>Role: Compliance Officer</span>
        </div>
      </div>
      <div class="profile-stats">
        Work Done: 50 Violations Reviewed
      </div>
      <hr>
      <a href="/logout">Logout</a>
    </div>
  </div>
</div>

<!-- Hero Section -->
<div class="hero">
  <h1>Categories & Brands Overview</h1>
  <p>Get a complete view of all product categories and brands, monitor compliance, and identify which areas need immediate attention.</p>
  <button onclick="document.getElementById('cardsSection').scrollIntoView({behavior:'smooth'})">Explore Reports</button>
</div>

<!-- Content -->
<div class="content" id="cardsSection">
  <!-- Top Cards -->
  <div class="cards">
    <div class="card"><h2>3</h2><p>Total Categories</p></div>
    <div class="card"><h2>{{ (laptop_products|length + mobile_products|length + protein_products|length) }}</h2><p>Total Products</p></div>

  </div>

  <!-- Category Selection and Filters -->
  <div class="filters">
    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
      <!-- Category Selection Dropdown -->
      <div style="position: relative; min-width: 200px;">
        <select id="categoryDropdown" onchange="showCategory(this.value)" 
                style="width: 100%; padding: 12px 40px 12px 15px; border: 2px solid #2F3C7E; background: white; color: #2F3C7E; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 4 5\"><path fill=\"%232F3C7E\" d=\"M2 0L0 2h4zm0 5L0 3h4z\"/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 12px;">
          <option value="all">All Categories</option>
          <option value="laptop">Electronics - Laptops </option>
          <option value="mobile">Electronics - Mobiles</option>
          <option value="protein">FMCG - Protein </option>
        </select>
      </div>
      
      <!-- Search Form -->
      <form method="POST" action="{{ url_for('search_products') }}" style="display: flex; gap: 10px; align-items: center;">
        <input type="text" name="search_term" placeholder="Search within selected category" value="{{ search_term or '' }}" 
               style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; min-width: 250px;">
        <input type="hidden" name="category" id="selected_category" value="{{ selected_category or 'all' }}">
        <button type="submit" style="padding: 8px 16px; background: #2F3C7E; color: white; border: none; border-radius: 5px; cursor: pointer;">
          Search
        </button>
      </form>
    </div>
  </div>

  <!-- Category Info -->
  <div id="categoryInfo" style="background:linear-gradient(135deg, #2F3C7E, #70C1B3); color:white; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); margin-bottom:20px;">
    <h3 id="categoryTitle" style="margin:0 0 10px 0; font-size:24px;">All Categories</h3>
    <p id="categoryCount" style="margin:0; font-size:16px; opacity:0.9;">Showing all {{ (laptop_products|length + mobile_products|length + protein_products|length) }} products</p>
  </div>

  <!-- Search Results -->
  {% if search_results and search_term and search_term.strip() %}
  <div style="background:white; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px;">
    <h3>Search Results ({{ search_results|length }} found)</h3>
    <p>Search term: "{{ search_term }}" in {{ selected_category }} category</p>
  </div>
  {% endif %}


  <!-- Table -->
  <table id="productsTable">
    <tr>
      <th>Category</th>
      <th>Product Name</th>
      <th>Price</th>
      <th>Details</th>
      <th>Image</th>
      <th>Product Link</th>
    </tr>
    
    <!-- Laptop Products -->
    <tbody id="laptop-products" class="category-section">
    {% for product in laptop_products %}
    <tr>
      <td>Laptop</td>
      <td>{{ product.name[:50] }}{% if product.name|length > 50 %}...{% endif %}</td>
      <td>{{ product.price }}</td>
      <td>{{ product.details[:100] }}{% if product.details|length > 100 %}...{% endif %}</td>
      <td><img src="{{ product.image_url }}" alt="Product Image" style="width:50px; height:50px; object-fit:cover; border-radius:5px;" onerror="this.style.display='none'"></td>
      <td><a href="{{ product.product_link }}" target="_blank" style="color:#2F3C7E; text-decoration:none;">View Product</a></td>
    </tr>
    {% endfor %}
    </tbody>
    
    <!-- Mobile Products -->
    <tbody id="mobile-products" class="category-section">
    {% for product in mobile_products %}
    <tr>
      <td>Mobile</td>
      <td>{{ product.name[:50] }}{% if product.name|length > 50 %}...{% endif %}</td>
      <td>{{ product.price }}</td>
      <td>{{ product.details[:100] }}{% if product.details|length > 100 %}...{% endif %}</td>
      <td><img src="{{ product.image_url }}" alt="Product Image" style="width:50px; height:50px; object-fit:cover; border-radius:5px;" onerror="this.style.display='none'"></td>
      <td><a href="{{ product.product_link }}" target="_blank" style="color:#2F3C7E; text-decoration:none;">View Product</a></td>
    </tr>
    {% endfor %}
    </tbody>
    
    <!-- Protein Products -->
    <tbody id="protein-products" class="category-section">
    {% for product in protein_products %}
    <tr>
      <td>Protein</td>
      <td>{{ product['Product Name'][:50] }}{% if product['Product Name']|length > 50 %}...{% endif %}</td>
      <td>{{ product.Price }}</td>
      <td>{{ product['Sales Package'][:100] }}{% if product['Sales Package']|length > 100 %}...{% endif %}</td>
      <td><img src="{{ product.Image }}" alt="Product Image" style="width:50px; height:50px; object-fit:cover; border-radius:5px;" onerror="this.style.display='none'"></td>
      <td><a href="{{ product['Product Link'] }}" target="_blank" style="color:#2F3C7E; text-decoration:none;">View Product</a></td>
    </tr>
    {% endfor %}
    </tbody>
    
    <!-- Search Results -->
    {% if search_results and search_term and search_term.strip() %}
    {% for product in search_results %}
    <tr style="background-color:#f0f8ff;">
      <td>
        {% if 'name' in product and 'image_url' in product %}
          Laptop
        {% elif 'name' in product and 'image_url' in product %}
          Mobile
        {% else %}
          Protein
        {% endif %}
      </td>
      <td>
        {% if 'name' in product %}
          {{ product.name[:50] }}{% if product.name|length > 50 %}...{% endif %}
        {% else %}
          {{ product['Product Name'][:50] }}{% if product['Product Name']|length > 50 %}...{% endif %}
        {% endif %}
      </td>
      <td>
        {% if 'price' in product %}
          {{ product.price }}
        {% else %}
          {{ product.Price }}
        {% endif %}
      </td>
      <td>
        {% if 'details' in product %}
          {{ product.details[:100] }}{% if product.details|length > 100 %}...{% endif %}
        {% elif 'Sales Package' in product %}
          {{ product['Sales Package'][:100] }}{% if product['Sales Package']|length > 100 %}...{% endif %}
        {% else %}
          No details available
        {% endif %}
      </td>
      <td>
        {% if 'image_url' in product %}
          <img src="{{ product.image_url }}" alt="Product Image" style="width:50px; height:50px; object-fit:cover; border-radius:5px;" onerror="this.style.display='none'">
        {% else %}
          <img src="{{ product.Image }}" alt="Product Image" style="width:50px; height:50px; object-fit:cover; border-radius:5px;" onerror="this.style.display='none'">
        {% endif %}
      </td>
      <td>
        {% if 'product_link' in product %}
          <a href="{{ product.product_link }}" target="_blank" style="color:#2F3C7E; text-decoration:none;">View Product</a>
        {% else %}
          <a href="{{ product['Product Link'] }}" target="_blank" style="color:#2F3C7E; text-decoration:none;">View Product</a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
    {% endif %}
  </table>

  <!-- Chart -->
  <canvas id="catBrandChart" style="margin-top:30px;"></canvas>
</div>

<footer>
  &copy; 2025 Vigyantram | AI Compliance Dashboard
</footer>

<script>
function toggleMenu(){
  document.getElementById('nav-links').classList.toggle('show');
}

function toggleDropdown(){
  document.getElementById('profileDropdown').classList.toggle('show');
}

window.onclick = function(event){
  if(!event.target.matches('.profile-icon')){
    document.getElementById('profileDropdown').classList.remove('show');
  }
}

// Category selection functionality
function showCategory(category) {
  // Update dropdown selection
  const dropdown = document.getElementById('categoryDropdown');
  if (dropdown) {
    dropdown.value = category;
  }
  
  // Update hidden input for search form
  document.getElementById('selected_category').value = category;
  
  // Show/hide table sections
  const sections = document.querySelectorAll('.category-section');
  sections.forEach(section => {
    section.style.display = 'none';
  });
  
  // Hide search results if any
  const searchRows = document.querySelectorAll('tr[style*="background-color:#f0f8ff"]');
  searchRows.forEach(row => {
    row.style.display = 'none';
  });
  
  if (category === 'all') {
    sections.forEach(section => {
      section.style.display = 'table-row-group';
    });
  } else {
    const targetSection = document.getElementById(`${category}-products`);
    if (targetSection) {
      targetSection.style.display = 'table-row-group';
    }
  }
  
  // Update search placeholder
  const searchInput = document.querySelector('input[name="search_term"]');
  if (category === 'all') {
    searchInput.placeholder = 'Search all products...';
  } else {
    const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
    searchInput.placeholder = `Search ${categoryName} products...`;
  }
  
  // Update category info section
  const categoryTitle = document.getElementById('categoryTitle');
  const categoryCount = document.getElementById('categoryCount');
  
  if (category === 'all') {
    categoryTitle.textContent = 'All Categories';
    categoryCount.textContent = 'Showing all {{ (laptop_products|length + mobile_products|length + protein_products|length) }} products';
  } else {
    const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
    categoryTitle.textContent = `${categoryName} Products`;
    
    let count = 0;
    if (category === 'laptop') count = {{ laptop_products|length }};
    else if (category === 'mobile') count = {{ mobile_products|length }};
    else if (category === 'protein') count = {{ protein_products|length }};
    
    categoryCount.textContent = `Showing ${count} ${categoryName.toLowerCase()} products`;
  }
  
  // Scroll to table to show the selected products
  document.getElementById('productsTable').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Initialize page - show all categories by default
document.addEventListener('DOMContentLoaded', function() {
  showCategory('all');
});

// Chart.js example (simple bar chart)
const ctx = document.getElementById('catBrandChart').getContext('2d');
const catBrandChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Laptops','Mobiles','Protein'],
    datasets: [{
      label: 'Products Available',
      data: [{{ laptop_products|length }}, {{ mobile_products|length }}, {{ protein_products|length }}],
      backgroundColor: ['#2F3C7E', '#70C1B3', '#DB5A5A']
    }]
  },
  options: { 
    responsive: true, 
    plugins: { 
      legend: { position: 'top' },
      title: {
        display: true,
        text: 'Product Categories Distribution'
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'Number of Products'
        }
      }
    }
  }
});
</script>
</body>
</html>
